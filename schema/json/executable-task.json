{
    "$id": "https://purl.org/ep.ivoa.net/schema/json/executable-task",
    "$schema": "http://json-schema.org/draft/2020-12/schema",
    "definitions": {
        "UUIDType": {
            "type": "string",
            "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
            "description": "A regular expression to match the syntax for a UUID as defined by RFC4122. Note this is no longer needed as the string format for 'uuid' was added in JSON schema 2019-09."
        },
        "ISO8601DurationType": {
            "type": "string",
            "pattern": "^P([0-9]+Y){0,1}([0-9]+M){0,1}([0-9]+D){0,1}(T([0-9]+H){0,1}([0-9]+M){0,1}([0-9]+S){0,1}){0,1}$",
            "description": "A regular expression to match the syntax for a time duration as defined by ISO 8601. Note this is no longer needed as the string format for 'duration' was added in JSON schema 2019-09."
        },
        "ISO8601DateTimeType": {
            "type": "string",
            "pattern": "^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2}(\\.[0-9]{1,}){0,1})$",
            "description": "A regular expression to match the syntax for a date time value as defined by ISO 8601. "
        },
        "BasicComplexType": {
            "type": "object",
            "properties": {
                "uuid": {
                    "$ref": "#/definitions/UUIDType",
                    "description": "A globally unique UUID (Universal Unique Identifier) for the component."
                },
                "type": {
                    "type": "string",
                    "format": "uri",
                    "description": "A machine readable URI identifying the component type. Any URI format may be used, but it is recomended to use a URL format that can be resolved to point to a resource that describes the type."
                },
                "title": {
                    "type": "string",
                    "description": "An optional human readable title for the component."
                },
                "description": {
                    "type": "string",
                    "description": "An optional human readable description of the component."
                }
            },
            "required": [
                "type",
                "uuid"
            ],
            "description": "A base class to include a standard set of properties in all our complex types."
        },
        "ComputeVolumeSpec": {
            "type": "object",
            "properties": {
                "path": {
                    "type": "string",
                    "description": "The filesystem location of the volume as seen from inside the execution environment."
                },
                "access": {
                    "enum": [
                        "READONLY",
                        "READWRITE"
                    ],
                    "description": "The filesystem access mode of the volume, as seen from inside the execution environment."
                }
            },
            "required": ["path"],
            "description": "A base class for volume specifications, providing a common set of properties."
        },
        "LocalVolumeSpec": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/ComputeVolumeSpec"}
            ],
            "properties": {
                "minsize": {
                    "type": "integer",
                    "description": "The minimum size of the volume in GiB (2^30) bytes. This is typically set by the client to indicate the minimum space required to execute the task."
                },
                "maxsize": {
                    "type": "integer",
                    "description": "The maximum size of the volume in GiB (2^30) bytes. This is typically set by the service to indicate the maximum space available for the task to use."
                }
            }
        },
        "ResourceVolumeSpec": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/ComputeVolumeSpec"}
            ],
            "properties": {
                "resource": {
                    "$ref": "#/definitions/UUIDType",
                    "description": "The UUID of the target resource."
                }
            },
            "description": "A volume specification that references a DataResource or StorageResource defined in the same document using the UUID of the target resource."
        },
        "DataResourceType": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/BasicComplexType"}
            ],
            "properties": {
                "location": {
                    "type": "string",
                    "format": "url"
                }
            }
        },
        "StorageResourceType": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/BasicComplexType"}
            ],
            "properties": {
                "minsize": {"type": "integer"},
                "maxsize": {"type": "integer"},
                "minlifetime": {
                    "type": "string",
                    "format": "duration"
                },
                "maxlifetime": {
                    "type": "string",
                    "format": "duration"
                }
            }
        },
        "ComputeResourceType": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/BasicComplexType"}
            ],
            "properties": {
                "instances": {"type": "integer"},
                "mincores": {"type": "integer"},
                "maxcores": {"type": "integer"},
                "minmemory": {"type": "integer"},
                "maxmemory": {"type": "integer"},
                "local-volumes": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/LocalVolumeSpec"}
                },
                "resource-volumes": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/ResourceVolumeSpec"}
                }
            }
        },
        "ComputePlatformType": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/BasicComplexType"}
            ],
            "properties": {}
        },
        "ExecutableTaskType": {
            "type": "object",
            "allOf": [
                {"$ref": "#/definitions/BasicComplexType"}
            ],
            "properties": {
                "minduration": {
                    "type": "string",
                    "format": "duration"
                },
                "maxduration": {
                    "type": "string",
                    "format": "duration"
                },
                "data-resources": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/DataResourceType"}
                },
                "compute-resources": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/ComputeResourceType"}
                },
                "storage-resources": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/StorageResourceType"}
                }
            }
        }
    }
}
